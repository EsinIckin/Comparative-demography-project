---
title: "Reindeers"
author: "Esin Ickin"
date: "2023-04-21"
output: html_document
---

doi: https://doi.org/10.1038/s41467-019-09332-5

## 0) Prepare session

```{r}
rm(list=ls())
library(boot)
library(popbio)
library(tidyverse)
library(zoo)
```

```{r setup, include=FALSE}
# set wd
knitr::opts_knit$set(root.dir = "~reindeer")
```


## 1) Vital rates

The vital rates are defined as functions, and we need the coefficients from vital rate models.

To obtain the uncertainties around our estimates we need ideally the posterior samples of each parameter from table 2 in the supplementary. Then, we can repeat our analysis and resample everytime from the distributions. 

```{r}

# SURVIVAL parameters
# load posterior samples
load("coeffic_lmer_withintercept.Rdata")
# "coeffic": all posterior samples for survival parameters (table S2)
# each row = one posterior sample (9,090 in total)
# each column = one parameter

#Column 1: intercept (including age 1)
age1.par=coeffic[,1]

#Column 2:  age 2
age2.par=coeffic[,2]

#Column 3: age 3
age3.par=coeffic[,3]

#Column 4: age 4
age4.par=coeffic[,4]

#Column 5: age 5
age5.par=coeffic[,5]

#Column 6: age 6
age6.par=coeffic[,6]

#Column 7: Nposthunt
Nposthunt.par=coeffic[,7]

#Column 8: year
#year.par=coeffic[,8]

#Column 9: ROS
ROS.par=coeffic[,9]

#Column 10: winter length
winterlength.par=coeffic[,10]

#Column 11: ROS effect age 2 (to be added to column 9)
ROS2.par=coeffic[,11]

#Column 12: ROS effect age 3 (to be added to column 9)
ROS3.par=coeffic[,12]

#Column 13: ROS effect age 4 (to be added to column 9)
ROS4.par=coeffic[,13]

#Column 14: ROS effect age 5 (to be added to column 9)
ROS5.par=coeffic[,14]

#Column 15: ROS effect age 6 (to be added to column 9)
ROS6.par=coeffic[,15]

#Column 16: k
k.par=coeffic[,16]

# SURVIVAL
# equation 1 in paper
# estimates are from supp tbl 2
# logit(S) = Age class 1 + N.posthunt + (ROS * exp(k*N.posthunt)) + winterlength  +  ROS'Age class 1
# Si = inv.logit(intercept+age + Nposthunt.par*dens + ROS.par*(ROS*exp(k.par*N.posthunt.par*dens)) + winterlength.par*winterlength + age*ROS.par*(ROS*exp(k.par*Nposthunt.par*dens)))

# age class 1
S1 <- function(dens,ROS,winterlength,age1.par,Nposthunt.par,ROS.par,k.par){
  s <- inv.logit(age1.par + Nposthunt.par*dens + (ROS.par)*(ROS*exp(k.par*Nposthunt.par*dens)) + (ROS.par)*(ROS*exp(k.par*Nposthunt.par*dens)*age1.par*1))
  return(s)
}

#mean(S1(mean.dens,mean.ROS,mean.winterlength,age1.par,Nposthunt.par,ROS.par,k.par))

# age class 2
S2 <- function(dens,ROS,winterlength,age2.par,Nposthunt.par,ROS.par,ROS2.par,k.par){
  s <- inv.logit(age2.par*2 + Nposthunt.par*dens + (ROS.par+ROS2.par)*(ROS*exp(k.par*Nposthunt.par*dens)) + (ROS.par+ROS2.par)*(ROS*exp(k.par*Nposthunt.par*dens)*age2.par*2))
  return(s)
}

#mean(S2(mean.dens,mean.ROS,mean.winterlength,age2.par,Nposthunt.par,ROS.par,ROS2.par,k.par))



# age class 3
S3 <- function(dens,ROS,winterlength,age3.par,Nposthunt.par,ROS.par,ROS3.par,k.par){
  s <- inv.logit(age3.par*3 + Nposthunt.par*dens + (ROS.par+ROS3.par)*(ROS*exp(k.par*Nposthunt.par*dens)) + (ROS.par+ROS3.par)*(ROS*exp(k.par*Nposthunt.par*dens)*age3.par*3))
  return(s)
}

#mean(S3(mean.dens,mean.ROS,mean.winterlength,age3.par,Nposthunt.par,ROS.par,ROS3.par,k.par))

# age class 4
S4 <- function(dens,ROS,winterlength,age4.par,Nposthunt.par,ROS.par,ROS4.par,k.par){
  s <- inv.logit(age4.par*4 + Nposthunt.par*dens + (ROS.par+ROS4.par)*(ROS*exp(k.par*Nposthunt.par*dens)) + (ROS.par+ROS4.par)*(ROS*exp(k.par*Nposthunt.par*dens)*age4.par*4))
  return(s)
}

#mean(S4(mean.dens,mean.ROS,mean.winterlength,age4.par,Nposthunt.par,ROS.par,ROS4.par,k.par))

# age class 5
S5 <- function(dens,ROS,winterlength,age5.par,Nposthunt.par,ROS.par,ROS5.par,k.par){
  s <- inv.logit(age5.par*5 + Nposthunt.par*dens + (ROS.par+ROS5.par)*(ROS*exp(k.par*Nposthunt.par*dens)) + (ROS.par+ROS5.par)*(ROS*exp(k.par*Nposthunt.par*dens)*age5.par*5))
  return(s)
}

#mean(S5(mean.dens,mean.ROS,mean.winterlength,age5.par,Nposthunt.par,ROS.par,ROS5.par,k.par))

# age class 6
S6 <- function(dens,ROS,winterlength,age6.par,Nposthunt.par,ROS.par,ROS6.par,k.par){
  s <- inv.logit(age6.par*6 + Nposthunt.par*dens + (ROS.par+ROS6.par)*(ROS*exp(k.par*Nposthunt.par*dens)) + (ROS.par+ROS6.par)*(ROS*exp(k.par*Nposthunt.par*dens)*age6.par*6))
  return(s)
}

#mean(S6(mean.dens,mean.ROS,mean.winterlength,age6.par,Nposthunt.par,ROS.par,ROS6.par,k.par))



#############################################################

# FECUNDITY parameters
# load posterior samples
load("coefficF_lmer_withintercept.Rdata")

# intercept
#F.intercept=coefficF[,1]

# age class 2
F.age2.par=coefficF[,2]

# age class 3
F.age3.par=coefficF[,3]

# age class 4
F.age4.par=coefficF[,4]

# age class 5
F.age5.par=coefficF[,5]

# Nposthunt
F.Nposthunt=coefficF[,6]

# year
#F.year.par=coefficF[,7]

# ROS
F.ROS.par=coefficF[,8]

# winterlength
F.winterlength.par=coefficF[,9]

# ROS effect age 2 (to be addedto column 8)
F.ROS2.par=coefficF[,10]

# ROS effect age 3 (to be addedto column 8)
F.ROS3.par=coefficF[,11]

# ROS effect age 2 (to be addedto column 8)
F.ROS4.par=coefficF[,12]

# ROS effect age 2 (to be addedto column 8)
F.ROS5.par=coefficF[,13]

# k
F.k.par=coefficF[,14]


# FECUNDITY
# equation 2 in paper
# estimates are from supp tbl 2
# without year effect

# logit(F) = age class + N.posthunt + ROS * exp(k*N.posthunt)) + winter length + ROS'age class 

#Fi = inv.logit(F.agei.par*i + F.Nposthunt*dens + (F.ROS.par+F.ROSi.par)*(ROS*exp(F.k.par*F.Nposthunt*dens)) + (F.ROS.par+F.ROSi.par)*(ROS*exp(F.k.par*F.Nposthunt*dens)*F.agei.par*i))

# age class 2
F2 <- function(dens,ROS,winterlength,F.age2.par,F.Nposthunt,F.ROS.par,F.ROS2.par,F.k.par){
  f <- inv.logit(F.age2.par*2 + F.Nposthunt*dens + (F.ROS.par+F.ROS2.par)*(ROS*exp(F.k.par*F.Nposthunt*dens)) + (F.ROS.par+F.ROS2.par)*(ROS*exp(F.k.par*F.Nposthunt*dens)*F.age2.par*2))
  return(f)
  
}

#mean(F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par,F.Nposthunt,F.ROS.par,F.ROS2.par,F.k.par))

# age class 3
F3 <- function(dens,ROS,winterlength,F.age3.par,F.Nposthunt,F.ROS.par,F.ROS3.par,F.k.par){
  f <- inv.logit(F.age3.par*3 + F.Nposthunt*dens + (F.ROS.par+F.ROS3.par)*(ROS*exp(F.k.par*F.Nposthunt*dens)) + (F.ROS.par+F.ROS3.par)*(ROS*exp(F.k.par*F.Nposthunt*dens)*F.age3.par*3))
  return(f)
  
}
#mean(F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par,F.Nposthunt,F.ROS.par,F.ROS3.par,F.k.par))

# age class 4
F4 <- function(dens,ROS,winterlength,F.age4.par,F.Nposthunt,F.ROS.par,F.ROS4.par,F.k.par){
  f <- inv.logit(F.age4.par*4 + F.Nposthunt*dens + (F.ROS.par+F.ROS4.par)*(ROS*exp(F.k.par*F.Nposthunt*dens)) + (F.ROS.par+F.ROS4.par)*(ROS*exp(F.k.par*F.Nposthunt*dens)*F.age4.par*4))
  return(f)
  
}
#mean(F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par,F.Nposthunt,F.ROS.par,F.ROS4.par,F.k.par))

# age class 5
F5 <- function(dens,ROS,winterlength,F.age5.par,F.Nposthunt,F.ROS.par,F.ROS5.par,F.k.par){
  f <- inv.logit(F.age5.par*5 + F.Nposthunt*dens + (F.ROS.par+F.ROS5.par)*(ROS*exp(F.k.par*F.Nposthunt*dens)) + (F.ROS.par+F.ROS5.par)*(ROS*exp(F.k.par*F.Nposthunt*dens)*F.age5.par*5))
  return(f)
  
}
#mean(F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par,F.Nposthunt,F.ROS.par,F.ROS5.par,F.k.par))

```


## 2) Covariates

```{r}
cov <- read.csv("data_reindeer.txt",sep="")
# scaled pop density
cov$N <- (cov$N - mean(cov$N)) / sd(cov$N)

# ROS (rain-on-snow)
min.ROS=min(cov$ROS)
max.ROS=max(cov$ROS)
sd.ROS=sd(cov$ROS)
mean.ROS=mean(cov$ROS)

# winter length
min.winterlength=min(cov$Winter.length)
max.winterlength=max(cov$Winter.length)
sd.winterlength=sd(cov$Winter.length)
mean.winterlength=mean(cov$Winter.length)

# population density (scaled)
min.dens=min(cov$N)
max.dens=max(cov$N)
sd.dens=1
mean.dens=0

# Covariation
## ROS
ROS_when_winterlength_max=cov$ROS[which(cov$Winter.length==max(cov$Winter.length))][1]
ROS_when_winterlength_min=cov$ROS[which(cov$Winter.length==min(cov$Winter.length))][1]
ROS_when_dens_max=cov$ROS[which(cov$N==max(cov$N))][1]
ROS_when_dens_min=cov$ROS[which(cov$N==min(cov$N))][1]
## winter length
winterlength_when_dens_max=cov$Winter.length[which(cov$N==max(cov$N))][1]
winterlength_when_dens_min=cov$Winter.length[which(cov$N==min(cov$N))][1]
winterlength_when_ROS_max=cov$Winter.length[which(cov$ROS==max(cov$ROS))][1]
winterlength_when_ROS_min=cov$Winter.length[which(cov$ROS==min(cov$ROS))][1]
## dens
dens_when_winterlength_max=cov$N[which(cov$Winter.length==max(cov$Winter.length))][1]
dens_when_winterlength_min=cov$N[which(cov$Winter.length==min(cov$Winter.length))][1]
dens_when_ROS_max=cov$N[which(cov$ROS==max(cov$ROS))][1]
dens_when_ROS_min=cov$N[which(cov$ROS==min(cov$ROS))][1]
```


## 3) Pop model
Matrix Population Model
```{r}
lambda=NULL
for(i in 1:100){
  mpm <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  lambda[i] <- lambda(mpm)
}

```



## 4) Scaled sensitivity analyses 

Here, we calculate scaled sensitivities, according to Morris et al. 2020 (DOI: https://doi.org/10.1073/pnas.1918363117)

### 4.1 ROS No Cov
Sensitivities to ROS assuming mean winter length and mean density
```{r}
Sens.ROS.NoCov=NULL
l_ratio.ROS.NoCov=NULL
which.coef=NULL

for(i in 1:nrow(coeffic)){
  # mpm when ROS max
  mpm.max <- matrix(c(0,S1(mean.dens,max.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                      F2(mean.dens,max.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,max.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                      F3(mean.dens,max.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,max.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                      F4(mean.dens,max.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,max.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                      F5(mean.dens,max.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,max.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                      0,0,0,0,0,S6(mean.dens,max.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  # mpm when ROS min
  mpm.min <- matrix(c(0,S1(mean.dens,min.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                      F2(mean.dens,min.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,min.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                      F3(mean.dens,min.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,min.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                      F4(mean.dens,min.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,min.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                      F5(mean.dens,min.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,min.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                      0,0,0,0,0,S6(mean.dens,min.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  # scaled sensitivities and log ratios
  
  if(lambda(mpm.min)>0.2){
    which.coef=c(which.coef,i)
    Sens.ROS.NoCov <- c(Sens.ROS.NoCov,abs((lambda(mpm.max)-lambda(mpm.min))/((max.ROS-min.ROS)/sd.ROS)))
    l_ratio.ROS.NoCov <- c(l_ratio.ROS.NoCov,abs(log(lambda(mpm.max)/lambda(mpm.min))))
  }
  
}

hist(Sens.ROS.NoCov)
mean(Sens.ROS.NoCov)
```


### 4.2 ROS Cov
Sensitivities to ROS assuming covarying covariates (covariation)
```{r}

Sens.ROS.Cov=NULL
l_ratio.ROS.Cov=NULL

for(i in which.coef){
  # mpm when ROS max
  mpm.max <- matrix(c(0,S1(dens_when_ROS_max,max.ROS,winterlength_when_ROS_max,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                      F2(dens_when_ROS_max,max.ROS,winterlength_when_ROS_max,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(dens_when_ROS_max,max.ROS,winterlength_when_ROS_max,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                      F3(dens_when_ROS_max,max.ROS,winterlength_when_ROS_max,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(dens_when_ROS_max,max.ROS,winterlength_when_ROS_max,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                      F4(dens_when_ROS_max,max.ROS,winterlength_when_ROS_max,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(dens_when_ROS_max,max.ROS,winterlength_when_ROS_max,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                      F5(dens_when_ROS_max,max.ROS,winterlength_when_ROS_max,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(dens_when_ROS_max,max.ROS,winterlength_when_ROS_max,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                      0,0,0,0,0,S6(dens_when_ROS_max,max.ROS,winterlength_when_ROS_max,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  # mpm when ROS min
  mpm.min <- matrix(c(0,S1(dens_when_ROS_min,min.ROS,winterlength_when_ROS_min,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                      F2(dens_when_ROS_min,min.ROS,winterlength_when_ROS_min,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(dens_when_ROS_min,min.ROS,winterlength_when_ROS_min,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                      F3(dens_when_ROS_min,min.ROS,winterlength_when_ROS_min,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(dens_when_ROS_min,min.ROS,winterlength_when_ROS_min,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                      F4(dens_when_ROS_min,min.ROS,winterlength_when_ROS_min,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(dens_when_ROS_min,min.ROS,winterlength_when_ROS_min,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                      F5(dens_when_ROS_min,min.ROS,winterlength_when_ROS_min,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(dens_when_ROS_min,min.ROS,winterlength_when_ROS_min,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                      0,0,0,0,0,S6(dens_when_ROS_min,min.ROS,winterlength_when_ROS_min,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  # scaled sensitivities
  Sens.ROS.Cov <- c(Sens.ROS.Cov,abs((lambda(mpm.max)-lambda(mpm.min))/((max.ROS-min.ROS)/sd.ROS)))
  l_ratio.ROS.Cov <- c(l_ratio.ROS.Cov,abs(log(lambda(mpm.max)/lambda(mpm.min))))
}
hist(Sens.ROS.Cov)
mean(Sens.ROS.Cov)
```

### 4.3 Dens No Cov
Sensitivities to density assuming mean winter length and mean ROS
```{r}
Sens.Dens.NoCov=NULL

for(i in which.coef){
  # mpm when dens max
  mpm.max <- matrix(c(0,S1(max.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(max.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(max.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(max.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(max.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(max.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(max.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(max.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(max.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(max.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
    # mpm when dens min
  mpm.min <- matrix(c(0,S1(min.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(min.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(min.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(min.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(min.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(min.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(min.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(min.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(min.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(min.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  # scaled sensitivities
  Sens.Dens.NoCov[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.dens-min.dens)/sd.dens))
}

hist(Sens.Dens.NoCov)
mean(Sens.Dens.NoCov)
```


### 4.4 Dens Cov
Sensitivities to density assuming covarying covariates (covariation)
```{r}
Sens.Dens.Cov=NULL

for(i in which.coef){
  # mpm when dens max
  mpm.max <- matrix(c(0,S1(max.dens,ROS_when_dens_max,winterlength_when_dens_max,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(max.dens,ROS_when_dens_max,winterlength_when_dens_max,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(max.dens,ROS_when_dens_max,winterlength_when_dens_max,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(max.dens,ROS_when_dens_max,winterlength_when_dens_max,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(max.dens,ROS_when_dens_max,winterlength_when_dens_max,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(max.dens,ROS_when_dens_max,winterlength_when_dens_max,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(max.dens,ROS_when_dens_max,winterlength_when_dens_max,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(max.dens,ROS_when_dens_max,winterlength_when_dens_max,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(max.dens,ROS_when_dens_max,winterlength_when_dens_max,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(max.dens,ROS_when_dens_max,winterlength_when_dens_max,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
    # mpm when dens min
  mpm.min <- matrix(c(0,S1(min.dens,ROS_when_dens_min,winterlength_when_dens_min,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(min.dens,ROS_when_dens_min,winterlength_when_dens_min,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(min.dens,ROS_when_dens_min,winterlength_when_dens_min,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(min.dens,ROS_when_dens_min,winterlength_when_dens_min,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(min.dens,ROS_when_dens_min,winterlength_when_dens_min,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(min.dens,ROS_when_dens_min,winterlength_when_dens_min,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(min.dens,ROS_when_dens_min,winterlength_when_dens_min,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(min.dens,ROS_when_dens_min,winterlength_when_dens_min,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(min.dens,ROS_when_dens_min,winterlength_when_dens_min,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(min.dens,ROS_when_dens_min,winterlength_when_dens_min,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  # scaled sensitivities
  Sens.Dens.Cov[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.dens-min.dens)/sd.dens))
}

hist(Sens.Dens.Cov)
mean(Sens.Dens.Cov)
```

### 4.5 WL No Cov
Sensitivities to winterlength assuming mean density and mean ROS
```{r}
Sens.WL.NoCov=NULL

for(i in which.coef){
  # mpm when winterlength max
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,max.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,max.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,max.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,max.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,max.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,max.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,max.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,max.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,max.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,max.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
    # mpm when winterlength min
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,min.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,min.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,min.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,min.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,min.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,min.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,min.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,min.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,min.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,min.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  # scaled sensitivities
  Sens.WL.NoCov[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.winterlength-min.winterlength)/sd.winterlength))
}

hist(Sens.WL.NoCov)
mean(Sens.WL.NoCov)


for(i in 60){
mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,max.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,max.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,max.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,max.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,max.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,max.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,max.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,max.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,max.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,max.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
}

lambda(mpm.max)

for(i in 60){
    mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,min.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,min.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,min.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,min.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,min.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,min.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,min.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,min.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,min.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,min.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
}


lambda(mpm.max)
lambda(mpm.min)

```


### 4.6 WL Cov
Sensitivities to winterlength assuming mean density and mean ROS
```{r}
Sens.WL.Cov=NULL

for(i in which.coef){
  # mpm when winterlength max
  mpm.max <- matrix(c(0,S1(dens_when_winterlength_max,ROS_when_winterlength_max,max.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(dens_when_winterlength_max,ROS_when_winterlength_max,max.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(dens_when_winterlength_max,ROS_when_winterlength_max,max.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(dens_when_winterlength_max,ROS_when_winterlength_max,max.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(dens_when_winterlength_max,ROS_when_winterlength_max,max.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(dens_when_winterlength_max,ROS_when_winterlength_max,max.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(dens_when_winterlength_max,ROS_when_winterlength_max,max.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(dens_when_winterlength_max,ROS_when_winterlength_max,max.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(dens_when_winterlength_max,ROS_when_winterlength_max,max.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(dens_when_winterlength_max,ROS_when_winterlength_max,max.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
    # mpm when winterlength min
  mpm.min <- matrix(c(0,S1(dens_when_winterlength_min,ROS_when_winterlength_min,min.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(dens_when_winterlength_min,ROS_when_winterlength_min,min.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(dens_when_winterlength_min,ROS_when_winterlength_min,min.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(dens_when_winterlength_min,ROS_when_winterlength_min,min.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(dens_when_winterlength_min,ROS_when_winterlength_min,min.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(dens_when_winterlength_min,ROS_when_winterlength_min,min.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(dens_when_winterlength_min,ROS_when_winterlength_min,min.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(dens_when_winterlength_min,ROS_when_winterlength_min,min.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(dens_when_winterlength_min,ROS_when_winterlength_min,min.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(dens_when_winterlength_min,ROS_when_winterlength_min,min.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  # scaled sensitivities
  Sens.WL.Cov[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.winterlength-min.winterlength)/sd.winterlength))
}

hist(Sens.WL.Cov)
mean(Sens.WL.Cov)
```


# 5) Save Output
```{r}
ScaledSens_Reindeer=data.frame(species="Rangifer tarandus",
                      study.doi="10.1038/s41467-019-09332-5",
                      year.of.publication="2019",
                      group="Mammals",
                      continent="Europe",
                      driver=rep(c("ROS","Dens","Winterlength"),each=200),
                      driver.type=rep(c("C","D","C"),each=200),
                      stage.age="all",
                      vital.rates="all",
                      sens=c(Sens.ROS.NoCov,Sens.ROS.Cov,Sens.Dens.NoCov,Sens.Dens.Cov,Sens.WL.NoCov,Sens.WL.Cov),
                      cov=rep(c(0,1),each=100),
                      mat=1.9, # age at sexual maturity Source: Myhrvold et al. 2015
                      n.vr=10,
                      n.pam=49,
                      dens=1,
                      biotic_interactions=0,
                      lambda.sim=0,
                      study.length=20)


write.csv(ScaledSens_Reindeer,"SensReindeer.csv",row.names = F)

```


# Sensitivities per vital rate

Same analysis as above (Morris et al. 2020) but this time only perturb covariates in one vital rate per time.

## 6) ROS
stages: 1-6
reproductive stages: 2-5
non-reproductive stages: 1 & 6

#### 6.1 Survival for non-reproductive stages
```{r}
# stage 1
ROS.S1=NULL
for(i in which.coef){
  
  mpm.max <- matrix(c(0,S1(dens_when_ROS_max,max.ROS,winterlength_when_ROS_max,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(dens_when_ROS_min,min.ROS,winterlength_when_ROS_min,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   ROS.S1[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.ROS-min.ROS)/sd.ROS))
   
}

# stage 6
ROS.S6=NULL
for(i in which.coef){
  
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(dens_when_ROS_max,max.ROS,winterlength_when_ROS_max,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(dens_when_ROS_min,min.ROS,winterlength_when_ROS_min,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   ROS.S6[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.ROS-min.ROS)/sd.ROS))
   
}
```


### 6.2 Survival for reproductive stages
```{r}
# stage 2
ROS.S2=NULL
for(i in which.coef){
  
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(dens_when_ROS_max,max.ROS,winterlength_when_ROS_max,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(dens_when_ROS_min,min.ROS,winterlength_when_ROS_min,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   ROS.S2[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.ROS-min.ROS)/sd.ROS))
}

# stage 3
ROS.S3=NULL
for(i in which.coef){
  
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(dens_when_ROS_max,max.ROS,winterlength_when_ROS_max,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(dens_when_ROS_min,min.ROS,winterlength_when_ROS_min,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   ROS.S3[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.ROS-min.ROS)/sd.ROS))
}


# stage 4
ROS.S4=NULL
for(i in which.coef){
  
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(dens_when_ROS_max,max.ROS,winterlength_when_ROS_max,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(dens_when_ROS_min,min.ROS,winterlength_when_ROS_min,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   ROS.S4[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.ROS-min.ROS)/sd.ROS))
}


# stage 5
ROS.S5=NULL
for(i in which.coef){
  
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(dens_when_ROS_max,max.ROS,winterlength_when_ROS_max,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(dens_when_ROS_min,min.ROS,winterlength_when_ROS_min,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   ROS.S5[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.ROS-min.ROS)/sd.ROS))
}
```


### 6.3 Fecundity
```{r}
# stage 2
ROS.F2=NULL
for(i in which.coef){
  
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(dens_when_ROS_max,max.ROS,winterlength_when_ROS_max,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(dens_when_ROS_min,min.ROS,winterlength_when_ROS_min,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   ROS.F2[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.ROS-min.ROS)/sd.ROS))
}

# stage 3
ROS.F3=NULL
for(i in which.coef){
  
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(dens_when_ROS_max,max.ROS,winterlength_when_ROS_max,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(dens_when_ROS_min,min.ROS,winterlength_when_ROS_min,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   ROS.F3[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.ROS-min.ROS)/sd.ROS))
}


# stage 4
ROS.F4=NULL
for(i in which.coef){
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(dens_when_ROS_max,max.ROS,winterlength_when_ROS_max,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(dens_when_ROS_min,min.ROS,winterlength_when_ROS_min,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   ROS.F4[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.ROS-min.ROS)/sd.ROS))
}


# stage 5
ROS.F5=NULL
for(i in which.coef){
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(dens_when_ROS_max,max.ROS,winterlength_when_ROS_max,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(dens_when_ROS_min,min.ROS,winterlength_when_ROS_min,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   ROS.F5[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.ROS-min.ROS)/sd.ROS))
}
```





## 7) Density

### 7.1 Survival for non-reproductive stages
```{r}
# stage 1
DENS.S1=NULL
for(i in which.coef){
  
  mpm.max <- matrix(c(0,S1(max.dens,ROS_when_dens_max,winterlength_when_dens_max,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(min.dens,ROS_when_dens_min,winterlength_when_dens_min,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   DENS.S1[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.dens-min.dens)/sd.dens))
   
}

# stage 6
DENS.S6=NULL
for(i in which.coef){
  
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(max.dens,ROS_when_dens_max,winterlength_when_dens_max,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(min.dens,ROS_when_dens_min,winterlength_when_dens_min,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   DENS.S6[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.dens-min.dens)/sd.dens))
   
}
```


### 6.2 Survival for reproductive stages
```{r}
# stage 2
DENS.S2=NULL
for(i in which.coef){
  
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(max.dens,ROS_when_dens_max,winterlength_when_dens_max,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(min.dens,ROS_when_dens_min,winterlength_when_dens_min,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   DENS.S2[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.dens-min.dens)/sd.dens))
}

# stage 3
DENS.S3=NULL
for(i in which.coef){
  
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(max.dens,ROS_when_dens_max,winterlength_when_dens_max,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(min.dens,ROS_when_dens_min,winterlength_when_dens_min,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   DENS.S3[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.dens-min.dens)/sd.dens))
}


# stage 4
DENS.S4=NULL
for(i in which.coef){
  
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(max.dens,ROS_when_dens_max,winterlength_when_dens_max,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(min.dens,ROS_when_dens_min,winterlength_when_dens_min,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   DENS.S4[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.dens-min.dens)/sd.dens))
}


# stage 5
DENS.S5=NULL
for(i in which.coef){
  
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(max.dens,ROS_when_dens_max,winterlength_when_dens_max,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(min.dens,ROS_when_dens_min,winterlength_when_dens_min,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   DENS.S5[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.dens-min.dens)/sd.dens))
}
```


### 6.3 Fecundity
```{r}
# stage 2
DENS.F2=NULL
for(i in which.coef){
  
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(max.dens,ROS_when_dens_max,winterlength_when_dens_max,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(min.dens,ROS_when_dens_min,winterlength_when_dens_min,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   DENS.F2[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.dens-min.dens)/sd.dens))
}

# stage 3
DENS.F3=NULL
for(i in which.coef){
  
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(max.dens,ROS_when_dens_max,winterlength_when_dens_max,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(min.dens,ROS_when_dens_min,winterlength_when_dens_min,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   DENS.F3[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.dens-min.dens)/sd.dens))
}


# stage 4
DENS.F4=NULL
for(i in which.coef){
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(max.dens,ROS_when_dens_max,winterlength_when_dens_max,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(min.dens,ROS_when_dens_min,winterlength_when_dens_min,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   DENS.F4[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.dens-min.dens)/sd.dens))
}


# stage 5
DENS.F5=NULL
for(i in which.coef){
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(max.dens,ROS_when_dens_max,winterlength_when_dens_max,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(min.dens,ROS_when_dens_min,winterlength_when_dens_min,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   DENS.F5[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.dens-min.dens)/sd.dens))
}
```





## 8) Winterlength

### 7.1 Survival for non-reproductive stages
```{r}
# stage 1
WL.S1=NULL
for(i in which.coef){
  
  mpm.max <- matrix(c(0,S1(dens_when_winterlength_max,ROS_when_winterlength_max,max.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(dens_when_winterlength_min,ROS_when_winterlength_min,min.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   WL.S1[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.dens-min.dens)/sd.dens))
   
}

# stage 6
WL.S6=NULL
for(i in which.coef){
  
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(dens_when_winterlength_max,ROS_when_winterlength_max,max.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(dens_when_winterlength_min,ROS_when_winterlength_min,min.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   WL.S6[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.dens-min.dens)/sd.dens))
   
}
```


### 6.2 Survival for reproductive stages
```{r}
# stage 2
WL.S2=NULL
for(i in which.coef){
  
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(dens_when_winterlength_max,ROS_when_winterlength_max,max.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(dens_when_winterlength_min,ROS_when_winterlength_min,min.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   WL.S2[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.dens-min.dens)/sd.dens))
}

# stage 3
WL.S3=NULL
for(i in which.coef){
  
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(dens_when_winterlength_max,ROS_when_winterlength_max,max.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(dens_when_winterlength_min,ROS_when_winterlength_min,min.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   WL.S3[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.dens-min.dens)/sd.dens))
}


# stage 4
WL.S4=NULL
for(i in which.coef){
  
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(dens_when_winterlength_max,ROS_when_winterlength_max,max.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(dens_when_winterlength_min,ROS_when_winterlength_min,min.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   WL.S4[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.dens-min.dens)/sd.dens))
}


# stage 5
WL.S5=NULL
for(i in which.coef){
  
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(dens_when_winterlength_max,ROS_when_winterlength_max,max.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(dens_when_winterlength_min,ROS_when_winterlength_min,min.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   WL.S5[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.dens-min.dens)/sd.dens))
}
```


### 6.3 Fecundity
```{r}
# stage 2
WL.F2=NULL
for(i in which.coef){
  
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(dens_when_winterlength_max,ROS_when_winterlength_max,max.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(dens_when_winterlength_min,ROS_when_winterlength_min,min.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   WL.F2[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.dens-min.dens)/sd.dens))
}

# stage 3
WL.F3=NULL
for(i in which.coef){
  
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(dens_when_winterlength_max,ROS_when_winterlength_max,max.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(dens_when_winterlength_min,ROS_when_winterlength_min,min.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   WL.F3[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.dens-min.dens)/sd.dens))
}


# stage 4
WL.F4=NULL
for(i in which.coef){
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(dens_when_winterlength_max,ROS_when_winterlength_max,max.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(dens_when_winterlength_min,ROS_when_winterlength_min,min.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(mean.dens,mean.ROS,mean.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   WL.F4[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.dens-min.dens)/sd.dens))
}


# stage 5
WL.F5=NULL
for(i in which.coef){
  mpm.max <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(dens_when_winterlength_max,ROS_when_winterlength_max,max.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
  
  mpm.min <- matrix(c(0,S1(mean.dens,mean.ROS,mean.winterlength,age1.par[i],Nposthunt.par[i],ROS.par[i],k.par[i]),0,0,0,0,
                  F2(mean.dens,mean.ROS,mean.winterlength,F.age2.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS2.par[i],F.k.par[i]),0,S2(mean.dens,mean.ROS,mean.winterlength,age2.par[i],Nposthunt.par[i],ROS.par[i],ROS2.par[i],k.par[i]),0,0,0,
                  F3(mean.dens,mean.ROS,mean.winterlength,F.age3.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS3.par[i],F.k.par[i]),0,0,S3(mean.dens,mean.ROS,mean.winterlength,age3.par[i],Nposthunt.par[i],ROS.par[i],ROS3.par[i],k.par[i]),0,0,
                  F4(mean.dens,mean.ROS,mean.winterlength,F.age4.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS4.par[i],F.k.par[i]),0,0,0,S4(mean.dens,mean.ROS,mean.winterlength,age4.par[i],Nposthunt.par[i],ROS.par[i],ROS4.par[i],k.par[i]),0,
                  F5(dens_when_winterlength_min,ROS_when_winterlength_min,min.winterlength,F.age5.par[i],F.Nposthunt[i],F.ROS.par[i],F.ROS5.par[i],F.k.par[i]),0,0,0,0,S5(mean.dens,mean.ROS,mean.winterlength,age5.par[i],Nposthunt.par[i],ROS.par[i],ROS5.par[i],k.par[i]),
                  0,0,0,0,0,S6(mean.dens,mean.ROS,mean.winterlength,age6.par[i],Nposthunt.par[i],ROS.par[i],ROS6.par[i],k.par[i])),6,6)
  
   WL.F5[i] <- abs((lambda(mpm.max)-lambda(mpm.min))/((max.dens-min.dens)/sd.dens))
}
```


## 9) Save Output
```{r}
Surv=data.frame(species="Rangifer tarandus",
                      study.doi="10.1038/s41467-019-09332-5",
                      year.of.publication="2019",
                      group="Mammals",
                      continent="Europe",
                      driver=rep(c("ROS","density","winterlength"),each=600),
                      driver.type=rep(c("C","D","C"),each=600),
                      stage.age=rep(c(1,2,3,4,5,6),each=100),
                      vital.rates="survival",
                      sens=c(ROS.S1,ROS.S2,ROS.S3,ROS.S4,ROS.S5,ROS.S6,
                             DENS.S1,DENS.S2,DENS.S3,DENS.S4,DENS.S5,DENS.S6,
                             WL.S1,WL.S2,WL.S3,WL.S4,WL.S5,WL.S6),
                      mat=1.9, # age at sexual maturity Source: Myhrvold et al. 2015
                      n.vr=10,
                      n.pam=49,
                      dens=1,
                      biotic_interactions=0,
                      lambda.sim=0,
                      study.length=20)


Fec=data.frame(species="Rangifer tarandus",
                      study.doi="10.1038/s41467-019-09332-5",
                      year.of.publication="2019",
                      group="Mammals",
                      continent="Europe",
                      driver=rep(c("ROS","density","winterlength"),each=600),
                      driver.type=rep(c("C","D","C"),each=400),
                      stage.age=rep(c(2,3,4,5),each=400),
                      vital.rates="fecundity",
                      sens=c(ROS.F2,ROS.F3,ROS.F4,ROS.F5,
                             DENS.F2,DENS.F3,DENS.F4,DENS.F5,
                             WL.F2,WL.F3,WL.F4,WL.F5),
                      mat=1.9, # age at sexual maturity Source: Myhrvold et al. 2015
                      n.vr=10,
                      n.pam=49,
                      dens=1,
                      biotic_interactions=0,
                      lambda.sim=0,
                      study.length=20)


SensVR=rbind(Surv,Fec)

write.csv(SensVR,"SensReindeer_VR.csv",row.names = F)
```

